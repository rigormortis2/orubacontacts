<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oruba Contacts - YÃ¶netim Paneli</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tab-active {
            @apply border-b-2 border-blue-600 text-blue-600;
        }
        .table-container {
            max-height: 600px;
            overflow-y: auto;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Oruba Contacts</h1>
            <p class="text-gray-600">Hastane Ä°letiÅŸim Bilgileri ve Raw Data YÃ¶netim Sistemi</p>
            <div class="mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                <p class="text-green-800 font-medium">âœ“ Backend API Ã§alÄ±ÅŸÄ±yor!</p>
                <p class="text-sm text-green-600 mt-1">API Base URL: http://localhost:3000/api</p>
            </div>
        </div>

        <!-- Tabs -->
        <div class="bg-white rounded-lg shadow-lg mb-6">
            <div class="flex border-b">
                <button onclick="showTab('contacts')" id="tab-contacts" class="px-6 py-3 font-medium text-gray-700 hover:text-blue-600 tab-active">
                    Hastaneler
                </button>
                <button onclick="showTab('rawdata')" id="tab-rawdata" class="px-6 py-3 font-medium text-gray-700 hover:text-blue-600">
                    Raw Data
                </button>
            </div>
        </div>

        <!-- Contacts Tab -->
        <div id="content-contacts" class="space-y-6">
            <!-- Contacts Table -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-900">Hastane Listesi</h2>
                    <button onclick="loadContacts()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        ðŸ”„ Yenile
                    </button>
                </div>
                <div id="contacts-loading" class="text-center py-8" style="display:none;">
                    <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
                    <p class="mt-4 text-gray-500">YÃ¼kleniyor...</p>
                </div>
                <div id="contacts-error" class="text-red-600 p-4 bg-red-50 rounded" style="display:none;"></div>
                <div class="table-container">
                    <table id="contacts-table" class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50 sticky top-0">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Hastane AdÄ±</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Ä°l</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">TÃ¼r</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Alt TÃ¼r</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tel Doktor</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tel SatÄ±nalma</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tel Biyomedikal</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Mail Doktor</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Mail SatÄ±nalma</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Mail Biyomedikal</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Ä°ÅŸlem</th>
                            </tr>
                        </thead>
                        <tbody id="contacts-tbody" class="bg-white divide-y divide-gray-200">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Add Contact Form -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Yeni Hastane Ekle</h2>
                <form id="add-contact-form" class="space-y-4">
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Hastane AdÄ± *</label>
                            <input type="text" name="hastaneAdi" required class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Ä°l *</label>
                            <input type="text" name="il" required class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Hastane TÃ¼rÃ¼ *</label>
                            <select name="hastaneTuru" required class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500">
                                <option value="kamu">Kamu</option>
                                <option value="Ã¶zel">Ã–zel</option>
                                <option value="muayenehane">Muayenehane</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Alt TÃ¼r</label>
                            <select name="altTur" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500">
                                <option value="">SeÃ§iniz</option>
                                <option value="eÄŸitim araÅŸtÄ±rma">EÄŸitim AraÅŸtÄ±rma</option>
                                <option value="devlet">Devlet</option>
                                <option value="ilÃ§e">Ä°lÃ§e</option>
                                <option value="Ã¼niversite">Ãœniversite</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tel Doktor</label>
                            <input type="tel" name="telefonDoktor" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tel SatÄ±nalma</label>
                            <input type="tel" name="telefonSatinalma" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tel Biyomedikal</label>
                            <input type="tel" name="telefonBiyomedikal" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Mail Doktor</label>
                            <input type="email" name="mailDoktor" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Mail SatÄ±nalma</label>
                            <input type="email" name="mailSatinalma" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Mail Biyomedikal</label>
                            <input type="email" name="mailBiyomedikal" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                    <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">
                        âž• Hastane Ekle
                    </button>
                </form>
                <div id="contact-success" class="mt-4 text-green-600 p-4 bg-green-50 rounded" style="display:none;"></div>
                <div id="contact-error" class="mt-4 text-red-600 p-4 bg-red-50 rounded" style="display:none;"></div>
            </div>
        </div>

        <!-- Raw Data Tab -->
        <div id="content-rawdata" class="space-y-6" style="display:none;">
            <!-- Raw Data Table -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-900">Raw Data Listesi</h2>
                    <button onclick="loadRawData()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        ðŸ”„ Yenile
                    </button>
                </div>
                <div id="rawdata-loading" class="text-center py-8" style="display:none;">
                    <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
                    <p class="mt-4 text-gray-500">YÃ¼kleniyor...</p>
                </div>
                <div id="rawdata-error" class="text-red-600 p-4 bg-red-50 rounded" style="display:none;"></div>
                <div class="table-container">
                    <table id="rawdata-table" class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50 sticky top-0">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Title</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Description</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">List Name</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Short URL</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Full URL</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Ä°ÅŸlem</th>
                            </tr>
                        </thead>
                        <tbody id="rawdata-tbody" class="bg-white divide-y divide-gray-200">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Add Raw Data Form -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-900 mb-4">Yeni Raw Data Ekle</h2>
                <form id="add-rawdata-form" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Title *</label>
                            <input type="text" name="title" required class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">List Name *</label>
                            <input type="text" name="listName" required class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                            <textarea name="description" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Short URL</label>
                            <input type="url" name="shortUrl" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Full URL</label>
                            <input type="url" name="fullUrl" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                    <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">
                        âž• Raw Data Ekle
                    </button>
                </form>
                <div id="rawdata-success" class="mt-4 text-green-600 p-4 bg-green-50 rounded" style="display:none;"></div>
                <div id="rawdata-error-form" class="mt-4 text-red-600 p-4 bg-red-50 rounded" style="display:none;"></div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000/api';

        // Tab Management
        function showTab(tab) {
            // Hide all tabs
            document.getElementById('content-contacts').style.display = 'none';
            document.getElementById('content-rawdata').style.display = 'none';

            // Remove active class from all tabs
            document.getElementById('tab-contacts').classList.remove('tab-active');
            document.getElementById('tab-rawdata').classList.remove('tab-active');

            // Show selected tab
            document.getElementById('content-' + tab).style.display = 'block';
            document.getElementById('tab-' + tab).classList.add('tab-active');

            // Load data
            if (tab === 'contacts') {
                loadContacts();
            } else if (tab === 'rawdata') {
                loadRawData();
            }
        }

        // Contacts Functions
        async function loadContacts() {
            const tbody = document.getElementById('contacts-tbody');
            const loadingDiv = document.getElementById('contacts-loading');
            const errorDiv = document.getElementById('contacts-error');

            tbody.innerHTML = '';
            errorDiv.style.display = 'none';
            loadingDiv.style.display = 'block';

            try {
                const response = await fetch(`${API_URL}/contacts`);
                if (!response.ok) throw new Error('API hatasÄ±');

                const contacts = await response.json();
                loadingDiv.style.display = 'none';

                if (contacts.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="11" class="px-4 py-8 text-center text-gray-500">HenÃ¼z hastane kaydÄ± yok</td></tr>';
                    return;
                }

                contacts.forEach(contact => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="px-4 py-3 text-sm font-medium text-gray-900">${contact.hastaneAdi}</td>
                        <td class="px-4 py-3 text-sm text-gray-600">${contact.il}</td>
                        <td class="px-4 py-3 text-sm">
                            <span class="px-2 py-1 text-xs font-medium rounded-full ${getTypeColor(contact.hastaneTuru)}">
                                ${contact.hastaneTuru}
                            </span>
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-600">${contact.altTur || '-'}</td>
                        <td class="px-4 py-3 text-sm text-gray-600">${contact.telefonDoktor || '-'}</td>
                        <td class="px-4 py-3 text-sm text-gray-600">${contact.telefonSatinalma || '-'}</td>
                        <td class="px-4 py-3 text-sm text-gray-600">${contact.telefonBiyomedikal || '-'}</td>
                        <td class="px-4 py-3 text-sm text-gray-600">${contact.mailDoktor || '-'}</td>
                        <td class="px-4 py-3 text-sm text-gray-600">${contact.mailSatinalma || '-'}</td>
                        <td class="px-4 py-3 text-sm text-gray-600">${contact.mailBiyomedikal || '-'}</td>
                        <td class="px-4 py-3 text-sm text-right">
                            <button onclick="deleteContact('${contact.id}')" class="text-red-600 hover:text-red-800 font-medium">
                                Sil
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                loadingDiv.style.display = 'none';
                errorDiv.style.display = 'block';
                errorDiv.textContent = 'Hastaneler yÃ¼klenirken hata oluÅŸtu: ' + error.message;
            }
        }

        function getTypeColor(type) {
            const colors = {
                'kamu': 'bg-blue-100 text-blue-800',
                'Ã¶zel': 'bg-green-100 text-green-800',
                'muayenehane': 'bg-purple-100 text-purple-800'
            };
            return colors[type] || 'bg-gray-100 text-gray-800';
        }

        async function deleteContact(id) {
            if (!confirm('Bu hastaneyi silmek istediÄŸinize emin misiniz?')) return;

            try {
                const response = await fetch(`${API_URL}/contacts/${id}`, {
                    method: 'DELETE'
                });
                if (!response.ok) throw new Error('Silme hatasÄ±');
                loadContacts();
            } catch (error) {
                alert('Hastane silinirken hata oluÅŸtu: ' + error.message);
            }
        }

        document.getElementById('add-contact-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const successDiv = document.getElementById('contact-success');
            const errorDiv = document.getElementById('contact-error');

            successDiv.style.display = 'none';
            errorDiv.style.display = 'none';

            const formData = new FormData(e.target);
            const data = {};
            formData.forEach((value, key) => {
                if (value) data[key] = value;
            });

            try {
                const response = await fetch(`${API_URL}/contacts`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Ekleme hatasÄ±');
                }

                successDiv.textContent = 'âœ“ Hastane baÅŸarÄ±yla eklendi!';
                successDiv.style.display = 'block';
                e.target.reset();
                loadContacts();

                setTimeout(() => {
                    successDiv.style.display = 'none';
                }, 3000);
            } catch (error) {
                errorDiv.textContent = 'âœ— Hata: ' + error.message;
                errorDiv.style.display = 'block';
            }
        });

        // Raw Data Functions
        async function loadRawData() {
            const tbody = document.getElementById('rawdata-tbody');
            const loadingDiv = document.getElementById('rawdata-loading');
            const errorDiv = document.getElementById('rawdata-error');

            tbody.innerHTML = '';
            errorDiv.style.display = 'none';
            loadingDiv.style.display = 'block';

            try {
                const response = await fetch(`${API_URL}/raw-data`);
                if (!response.ok) throw new Error('API hatasÄ±');

                const rawData = await response.json();
                loadingDiv.style.display = 'none';

                if (rawData.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" class="px-4 py-8 text-center text-gray-500">HenÃ¼z raw data kaydÄ± yok</td></tr>';
                    return;
                }

                rawData.forEach(item => {
                    const row = document.createElement('tr');
                    row.className = 'hover:bg-gray-50';
                    row.innerHTML = `
                        <td class="px-4 py-3 text-sm font-medium text-gray-900">${item.title}</td>
                        <td class="px-4 py-3 text-sm text-gray-600">${item.description || '-'}</td>
                        <td class="px-4 py-3 text-sm text-gray-600">${item.listName}</td>
                        <td class="px-4 py-3 text-sm text-blue-600">
                            ${item.shortUrl ? `<a href="${item.shortUrl}" target="_blank" class="hover:underline">Link</a>` : '-'}
                        </td>
                        <td class="px-4 py-3 text-sm text-blue-600">
                            ${item.fullUrl ? `<a href="${item.fullUrl}" target="_blank" class="hover:underline">Link</a>` : '-'}
                        </td>
                        <td class="px-4 py-3 text-sm text-right">
                            <button onclick="deleteRawData('${item.id}')" class="text-red-600 hover:text-red-800 font-medium">
                                Sil
                            </button>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            } catch (error) {
                loadingDiv.style.display = 'none';
                errorDiv.style.display = 'block';
                errorDiv.textContent = 'Raw data yÃ¼klenirken hata oluÅŸtu: ' + error.message;
            }
        }

        async function deleteRawData(id) {
            if (!confirm('Bu raw data kaydÄ±nÄ± silmek istediÄŸinize emin misiniz?')) return;

            try {
                const response = await fetch(`${API_URL}/raw-data/${id}`, {
                    method: 'DELETE'
                });
                if (!response.ok) throw new Error('Silme hatasÄ±');
                loadRawData();
            } catch (error) {
                alert('Raw data silinirken hata oluÅŸtu: ' + error.message);
            }
        }

        document.getElementById('add-rawdata-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const successDiv = document.getElementById('rawdata-success');
            const errorDiv = document.getElementById('rawdata-error-form');

            successDiv.style.display = 'none';
            errorDiv.style.display = 'none';

            const formData = new FormData(e.target);
            const data = {};
            formData.forEach((value, key) => {
                if (value) data[key] = value;
            });

            try {
                const response = await fetch(`${API_URL}/raw-data`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Ekleme hatasÄ±');
                }

                successDiv.textContent = 'âœ“ Raw data baÅŸarÄ±yla eklendi!';
                successDiv.style.display = 'block';
                e.target.reset();
                loadRawData();

                setTimeout(() => {
                    successDiv.style.display = 'none';
                }, 3000);
            } catch (error) {
                errorDiv.textContent = 'âœ— Hata: ' + error.message;
                errorDiv.style.display = 'block';
            }
        });

        // Load contacts on page load
        window.addEventListener('load', () => {
            showTab('contacts');
        });
    </script>
</body>
</html>
